{"version":3,"sources":["app/application.js","app/lib/appname_version.js","app/models/properties.js","app/router.js","app/views/app_layout.js","app/views/behaviors/destroy.js","app/views/behaviors/index.js","app/views/behaviors/toggle.js","app/views/message.js","app/views/templates/app_layout.jade","app/views/templates/message.jade"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxEA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAbA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3BA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/CA;AAAA;ACAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAfA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7CA;AAAA","file":"public/app.js","sourcesContent":["// Main application that create a Mn.Application singleton and\n// exposes it.\n\n\nvar Router = require('router');\nvar AppLayout = require('views/app_layout');\n\n\n// var Properties = require('models/properties');\nrequire('views/behaviors');\n\nvar Application = Mn.Application.extend({\n\n  initialize: function() {\n    // this.properties = Properties;\n  },\n\n  prepare: function() {\n    return Promise.resolve();\n  },\n\n  prepareInBackground: function() {\n    return this._defineViews();\n  },\n\n\n  _defineViews: function() {\n  },\n\n  onBeforeStart: function() {\n    this.layout = new AppLayout();\n    this.router = new Router();\n\n    if (typeof Object.freeze === 'function') {\n      Object.freeze(this);\n    }\n  },\n\n  onStart: function() {\n    this.layout.render();\n    // prohibit pushState because URIs mapped from cozy-home rely on fragment\n    if (Backbone.history) {\n      Backbone.history.start({ pushState: false });\n    }\n    // TODO : keep this, display always a random details.\n    //var randomIndex = Math.floor(Math.random() * this.subsets.size());\n    //this.trigger('requestform:setView', this.subsets.at(randomIndex));\n\n    console.log('hello');\n    this.listenTo(this, 'message:error', function() { console.log(arguments);} );\n\n    setTimeout(function() {\n      application.trigger('message:error', \"Hello Toto\");\n    console.log('helloeuhh');\n\n    }, 10000)\n\n  },\n\n});\n\nvar application = new Application();\n\nmodule.exports = application;\n\ndocument.addEventListener('DOMContentLoaded', function() {\n  application.prepare()\n    .then(function() { return application.prepareInBackground();})\n    .then(application.start.bind(application));\n});\n\n","var name = 'lamusiquedemesfilms';\nvar version = '0.0.1-dev';\n\nmodule.exports = name + '-' + version;\n","var appName = require('lib/appname_version');\n\nvar Properties = Backbone.Model.extend({\n\n  docType: 'MesInfosDataPlaygroundProperties'.toLowerCase(),\n  defaults: {\n    docTypeVersion: appName(),\n    synthSets: {},\n  },\n\n\n  parse: function(raw) {\n    raw.id = raw._id;\n    return raw;\n  },\n\n  sync: function(method, model, options) {\n    var callback = function(err, res) {\n      if (err) { return options.error(err); }\n      options.success(res);\n    }\n\n    if (method === 'create') {\n      return cozysdk.create(this.docType, model.attributes, callback);\n    } else if (method === 'update' || method === 'patch') {\n      return cozysdk.updateAttributes(this.docType, model.attributes._id, model.attributes, callback);\n    } else if (method === 'delete') {\n      return cozysdk.destroy(this.docType, model.attributes._id, callback);\n    } else if (method === 'read') {\n      if (model.isNew()) {\n        return cozysdk.defineView(Properties.prototype.docType, 'all',\n        'function(doc) { emit(doc._id);}'\n          ).then(function() {\n              return cozysdk.queryView(Properties.prototype.docType, 'all', {limit: 1, include_docs: true}); }\n          ).then(function(res) {\n            // TODO error handling !\n            return (res && res.length !== 0) ? res[0].doc : {};\n          }).then(options.success, options.error);\n      } else {\n        return cozysdk.find(this.docType, model.attributes._id)\n          .then(options.success, options.error);\n      }\n    }\n  },\n\n  _promiseSave: function(attributes) {\n    return new Promise(function(resolve, reject) {\n      this.save(attributes, { success: resolve, error: reject });\n    }.bind(this));\n  },\n\n  addSynthSetIds: function(setName, ids) {\n    var set = this.get('synthSets')[setName];\n    set = set ? set.concat(ids) : ids;\n\n    var sets = this.get('synthSets');\n    sets[setName] = set;\n    return this._promiseSave({ synthSets: sets });\n    // return new Promise(function(resolve, reject) {\n    //   this.save({ synthSets: sets }, { success: resolve, error: reject });\n    // }.bind(this));\n  },\n\n  cleanSynthSetIds: function(setName) {\n    var sets = this.get('synthSets');\n    delete sets[setName];\n    return this._promiseSave({ synthSets: sets});\n  },\n\n});\n\nmodule.exports = new Properties();\n","var app = undefined\n\nmodule.exports = Backbone.Router.extend({\n    routes: {\n        '': 'index',\n    },\n\n    initialize: function() {\n      app = require('application');\n    },\n\n\n    });\n","var MessageView = require('views/message');\n\nvar app = undefined;\n\nmodule.exports = Mn.View.extend({\n\n  template: require('views/templates/app_layout'),\n  el: '[role=\"application\"]',\n\n  behaviors: {},\n\n  regions: {\n    library: '.library',\n    search: '.searchfilms',\n    player: '.player',\n    details: '.details',\n    message: '.message',\n  },\n\n  initialize: function() {\n    app = require('application');\n  },\n\n  onRender: function() {\n    this.showChildView('message', new MessageView());\n  },\n});\n","module.exports = Mn.Behavior.extend({\n\n  events: {\n    'click .delete': 'destroyObject',\n  },\n\n  destroyObject: function() {\n    if (this.options.onDestroy) {\n      this.view[this.options.onDestroy]();\n    } else {\n      this.view.model.destroy();\n    }\n  },\n});\n","Mn.Behaviors.behaviorsLookup = function() { return window.Behaviors; };\n\nwindow.Behaviors = {\n  // Toggle: require('views/behaviors/toggle'),\n  // Destroy: require('views/behaviors/destroy'),\n};\n","module.exports = Mn.Behavior.extend({\n\n  events: {\n    'click .toggle': 'toggleExpand',\n  },\n\n\n  toggleExpand: function() {\n    this.$el.toggleClass('compact');\n    this.$el.toggleClass('expanded');\n\n    // if (this.ui.toHide) {\n    //   if (this.expanded) {\n    //     this.ui.toHide.hide();\n    //   } else {\n    //     this.ui.toHide.show();\n    //   }\n    // }\n\n    // this.expanded = !this.expanded;\n  },\n\n  onRender: function() {\n    this.$el.addClass('compact');\n    // this.expanded = false;\n  }\n});\n","var app = null;\n\nmodule.exports = Mn.View.extend({\n    tagName: 'div',\n    template: require('views/templates/message'),\n\n    ui: {\n      message: '.display',\n    },\n    events: {\n      'click .close': 'onClose',\n    },\n\n    initialize: function() {\n      app = require('application');\n      this.messages = {};\n      this.listenTo(app, 'message:display', this.onDisplay);\n      this.listenTo(app, 'message:hide', this.onHide);\n      this.listenTo(app, 'message:error', this.onDisplay);\n    },\n\n    serializeData: function() {\n      return { messages: this.messages  };\n    },\n\n    onError: function(message) {\n      this.onDisplay(Math.ceil(Math.random() * 10000), message);\n    },\n\n    onDisplay: function(id, message) {\n      console.log(message);\n      this.messages[id] = message;\n      this.render();\n    },\n\n    onClose: function(ev) {\n      this.onHide(ev.currentTarget.dataset.messageid);\n    },\n\n    onHide: function(id) {\n      delete this.messages[id];\n\n      this.render();\n\n    },\n\n});\n","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n\nbuf.push(\"<div class=\\\"message\\\"></div><input type=\\\"search\\\" placeholder=\\\"La grande Ã©vasion\\\" class=\\\"searchfilm form-control\\\"/><div class=\\\"library\\\"></div><div class=\\\"details\\\"></div><div class=\\\"player\\\"></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","var __templateData = function template(locals) {\nvar buf = [];\nvar jade_mixins = {};\nvar jade_interp;\n;var locals_for_with = (locals || {});(function (messages, undefined) {\njade_mixins[\"displayMessage\"] = jade_interp = function(id, m){\nvar block = (this && this.block), attributes = (this && this.attributes) || {};\nbuf.push(\"<li><span class=\\\"display\\\">\" + (jade.escape(null == (jade_interp = m) ? \"\" : jade_interp)) + \"</span><span\" + (jade.attr(\"data-messageid\", id, true, false)) + \" class=\\\"close\\\">X</span></li>\");\n};\nif ( (messages.length != 0))\n{\nbuf.push(\"<ul>\");\n// iterate messages\n;(function(){\n  var $$obj = messages;\n  if ('number' == typeof $$obj.length) {\n\n    for (var id = 0, $$l = $$obj.length; id < $$l; id++) {\n      var message = $$obj[id];\n\njade_mixins[\"displayMessage\"](id, message);\n    }\n\n  } else {\n    var $$l = 0;\n    for (var id in $$obj) {\n      $$l++;      var message = $$obj[id];\n\njade_mixins[\"displayMessage\"](id, message);\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</ul>\");\n}}.call(this,\"messages\" in locals_for_with?locals_for_with.messages:typeof messages!==\"undefined\"?messages:undefined,\"undefined\" in locals_for_with?locals_for_with.undefined:typeof undefined!==\"undefined\"?undefined:undefined));;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}"]}